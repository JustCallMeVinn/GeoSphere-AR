<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Edukasi Lapisan Bumi 3D</title>

    <!-- A-Frame & AR.js --> 
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <!-- Anime.js untuk animasi -->
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
        body{background:#000;overflow:hidden;height:100vh;color:#fff;position:relative}

        /* =====================================
           CAMERA RESPONSIVE FIX (PENTING)
        ===================================== */
        a-scene video,
        a-scene canvas,
        a-scene .a-canvas {
            width: 100% !important;
            height: 100% !important;
            position: fixed !important;
            top: 0; left: 0;
            object-fit: cover !important;
            z-index: 1 !important;
        }

        /* Tombol Panel */
        #togglePanel{
            position:fixed;bottom:20px;left:20px;width:56px;height:56px;
            background:#4CAF50;border:none;border-radius:50%;
            font-size:28px;color:#fff;cursor:pointer;z-index:99999;
            box-shadow:0 8px 25px rgba(76,175,80,0.6);
            transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display:none;
        }
        #togglePanel:hover{transform:scale(1.15) rotate(90deg)}

        /* Panel Utama */
        #mainPanel{
            position:fixed;bottom:20px;left:20px;right:20px;max-width:500px;
            background:rgba(15,15,35,0.92);backdrop-filter:blur(20px);
            border-radius:20px;border:1px solid rgba(255,255,255,0.1);
            box-shadow:0 15px 40px rgba(0,0,0,0.6);
            padding:18px;z-index:9999;
            transform:translateY(120%);transition:0.5s;
        }
        #mainPanel.visible{transform:translateY(0)}

        .panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
        .panel-header h3{font-size:18px;color:#4CAF50}

        .status-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:15px;font-size:13px}
        .status{padding:4px 8px;border-radius:6px;font-weight:bold;font-size:11px}
        .active{background:#4CAF50}
        .inactive{background:#f44336}
        .loading{background:#FF9800}

        /* Buttons */
        .btn-row{display:flex;gap:10px;margin:15px 0}
        button{padding:12px 20px;border:none;border-radius:12px;font-weight:bold;cursor:pointer}
        .danger{background:#FF5722;color:#fff}
        .secondary{background:#2196F3;color:#fff}

        /* Slider */
        .slider-row{display:flex;align-items:center;gap:12px;margin:10px 0;font-size:13px}
        input[type=range]{flex:1}

        /* Detail lapisan */
        .layer-info{margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.1)}
        .layer{font-size:12px;margin:8px 0;padding:8px;background:rgba(255,255,255,0.08);border-radius:8px;border-left:4px solid}
        .crust{border-color:#8B4513}
        .mantle{border-color:#FF6B35}
        .outer-core{border-color:#FFC300}
        .inner-core{border-color:#fff}

        /* Hint */
        #hint{
            position:fixed;bottom:90px;left:50%;transform:translateX(-50%);
            background:rgba(255,107,53,0.95);padding:14px 30px;border-radius:50px;
            font-weight:bold;font-size:15px;z-index:9999;opacity:0;transition:0.5s;
        }
        #hint.show{opacity:1}

        /* Start Screen */
        #startScreen{
            position:fixed;inset:0;background:#000;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            z-index:100000;
        }
        #startScreen button{
            padding:18px 50px;background:#4CAF50;border-radius:50px;color:#fff;
            border:none;font-size:18px;margin-top:20px;
        }
    </style>
</head>
<body>

<!-- Tombol Panel -->
<button id="togglePanel" onclick="togglePanel()">≡</button>

<!-- Panel -->
<div id="mainPanel">
    <div class="panel-header">
        <h3>Lapisan Bumi 3D</h3>
        <button onclick="togglePanel()" style="background:none;color:white;font-size:25px">✕</button>
    </div>

    <div class="status-grid">
        <div><span>Kamera:</span> <span id="camStatus" class="status loading">Loading...</span></div>
        <div><span>Marker:</span> <span id="markerStatus" class="status inactive">Cari Hiro</span></div>
        <div><span>Status:</span> <span id="openStatus">Tertutup</span></div>
    </div>

    <div class="btn-row">
        <button class="danger" id="openBtn" onclick="toggleOpen()">Buka Lapisan</button>
        <button class="secondary" id="rotBtn" onclick="toggleRot()">Rotasi ON</button>
    </div>

    <div class="slider-row">
        <span>Ukuran:</span> <span id="scaleVal">2.0</span>x
        <input type="range" min="0.5" max="6" step="0.1" value="2" oninput="setScale(this.value)">
    </div>

    <div class="slider-row">
        <span>Buka:</span> <span id="openVal">0</span>%
        <input id="openSlider" type="range" min="0" max="100" step="2" value="0" oninput="setOpen(this.value)">
    </div>

    <div class="layer-info">
        <div class="layer crust">Kerak Bumi — 5–70 km</div>
        <div class="layer mantle">Mantel — 2.900 km</div>
        <div class="layer outer-core">Inti Luar — Cair</div>
        <div class="layer inner-core">Inti Dalam — Padat</div>
    </div>
</div>

<div id="hint">Ketuk Bumi untuk Membelah!</div>

<!-- START SCREEN -->
<div id="startScreen">
    <h1 style="color:#4CAF50">Lapisan Bumi 3D</h1>
    <button onclick="startAR()">Mulai AR</button>
</div>

<!-- ==========================
     A-SCENE (sudah diperbaiki)
     ========================== -->
<a-scene
    id="scene"
    embedded
    vr-mode-ui="enabled:false"
    renderer="logarithmicDepthBuffer:true"
    device-orientation-permission-ui="enabled:true"
    style="display:none"
    arjs="sourceType: webcam; 
         facingMode: environment;
         sourceWidth:1280; sourceHeight:720;
         displayWidth:1280; displayHeight:720;
         debugUIEnabled:false;"
>
    <a-marker preset="hiro" id="marker">
        <a-entity id="earth" position="0 0 0" scale="2 2 2"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 15000; easing: linear">
            <a-gltf-model src="bumi_fixed.glb"></a-gltf-model>
        </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<script>
/* ================
   PANEL
================ */
function togglePanel(){
    document.getElementById("mainPanel").classList.toggle("visible");
}

/* ================
   AR START
================ */
function startAR(){
    document.getElementById("startScreen").remove();
    document.getElementById("scene").style.display = "block";
    document.getElementById("togglePanel").style.display = "block";

    setTimeout(()=>{
        document.getElementById("camStatus").className = "status active";
    },1500);
}

/* Marker Events */
document.addEventListener("DOMContentLoaded", ()=>{
    const marker = document.querySelector("#marker");
    marker.addEventListener("markerFound", ()=>{
        document.getElementById("markerStatus").className="status active";
        document.getElementById("hint").classList.add("show");
    });
    marker.addEventListener("markerLost", ()=>{
        document.getElementById("markerStatus").className="status inactive";
        document.getElementById("hint").classList.remove("show");
    });
});

/* ==========================
   BUKA/TUTUP BELAHAN BUMI
========================== */
let isOpen=false, progress=0;

function toggleOpen(){
    isOpen = !isOpen;
    const target = isOpen ? 100 : 0;

    anime({
        targets:{v:progress},
        v:target,
        duration:2000,
        easing:"easeOutExpo",
        update:(a)=>{
            progress = Math.round(a.animations[0].currentValue);
            setOpen(progress);
        }
    });

    document.getElementById("openBtn").textContent = isOpen ? "Tutup Lapisan" : "Buka Lapisan";
    document.getElementById("openStatus").textContent = isOpen ? "Terbuka":"Tertutup";
}

function setOpen(v){
    progress = v;
    document.getElementById("openVal").textContent = v;
    document.getElementById("openSlider").value = v;
    document.getElementById("earth").setAttribute("earth-belahan",`open:${v/100}`);
}

/* ==========================
   SCALE
========================== */
function setScale(v){
    document.getElementById("earth").setAttribute("scale",`${v} ${v} ${v}`);
    document.getElementById("scaleVal").textContent = v;
}

/* ==========================
   ROTASI
========================== */
let rotationOn = true;
function toggleRot(){
    rotationOn = !rotationOn;
    const earth = document.getElementById("earth");
    if(rotationOn){
        earth.setAttribute('animation','property: rotation; to: 0 360 0; loop: true; dur:15000; easing: linear');
    } else {
        earth.removeAttribute('animation');
    }
    document.getElementById("rotBtn").textContent=rotationOn?"Rotasi ON":"Rotasi OFF";
}

/* ==========================
   KLIK BUMI = BUKA
========================== */
document.querySelector("a-scene").addEventListener("click",()=>{
    toggleOpen();
});

/* ==========================
   COMPONENT BELAHAN
========================== */
AFRAME.registerComponent('earth-belahan',{
    schema:{open:{type:'number'}},
    init(){ this.ready=false; this.parts={}; },
    update(){
        const model = this.el.getObject3D("mesh");
        if(!model || this.ready){
            return this.animate(this.data.open);
        }
        this.ready = true;
        model.traverse(o=>{
            if(!o.isMesh) return;
            o.userData.pos = o.position.clone();
            const n = o.name.toLowerCase();
            if(n.includes("inner")) this.parts.inner=o;
            else if(n.includes("outer")) this.parts.outer=o;
            else if(n.includes("mantle")) this.parts.mantle=o;
            else if(n.includes("crust 2")) this.parts.right=o;
            else if(n.includes("crust")) this.parts.left=o;
        });
        this.animate(this.data.open);
    },
    animate(t){
        const sep=t*5, core=1+t*0.9;
        if(this.parts.left) this.parts.left.position.x = -sep;
        if(this.parts.right) this.parts.right.position.x = sep;
        if(this.parts.mantle) this.parts.mantle.position.x = sep*0.6;
        if(this.parts.outer) this.parts.outer.position.x = sep*0.4;
        if(this.parts.inner){
            this.parts.inner.scale.setScalar(core);
        }
    }
});
</script>

</body>
</html>
